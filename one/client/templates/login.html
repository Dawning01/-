<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="../static/css/01.css">
</head>
<body>

    <div><a href="#" onclick="two()">显示</a></div>
    <div id="ab"></div>
    <div id="start" style="display: none">
        <div class="start">


            <div class="login">登录我爱学习</div>
            <a href="#" class="gb"  onclick="one()"><img src="../static/images/gb.png"></a>
            <ul>
                <li><div class="username">
                    <span class="uid"></span>
                    <input type="text" placeholder="请输入用户名" class="user">
                </div></li>
                <li><div class="password">
                    <span class="pwd"></span>
                    <input type="password" placeholder="请输入密码" class="password_1">
                </div></li>
                <li ><div class="password abc" style="display:none" ><input type="text" placeholder="请输入验证码" class="ac"><i id="id" class="code"></i></div></li>

                <div class="main">
                    <input type="checkbox">记住密码
                    <a href="#" id="password">忘记密码</a>
                </div>
                <div><a href="#"><input type="submit" class="button" value="登录" onclick="login()" id="index"></a></div>
            </ul>

        </div>
        <a href="#"><img src="../static/images/qq.jpeg" class="there"></a>
        <a href="#"><img src="../static/images/wx.jpeg" class="two"></a>
        <a href="#"><img src="../static/images/wb.jpeg" class="ten"></a>
        <a class="six" href="http://127.0.0.1:5000/register">立刻注册</a>

    </div>

</body>
<script src="../static/js/login.js"></script>
<script src="../static/js/jquery.min.js"></script>
<script>

    var a=0;
    function login(){
        var username=$('.user').val();
        var password=$('.password_1').val();
        var code=$('.ac').val();
        var codes=verifyCode['options']['code'];

<!--        if(!verifyCode.validate(code))-->
<!--		{-->
<!--		    $('.code').html('验证码错误')-->
<!--			return-->
<!--		}-->
        var post_data={'username':username,'password':password,'code':code,'codes':codes,'a':a};
        console.log(post_data)

        $.ajax({
		   	url:'http://127.0.0.1:8000/v1/tokens',
		   	type:'POST',
		   	dataType:'json',
		   	data:JSON.stringify(post_data),
		   	contentType:'application/json',
		   	success:function(res){
		   		    if(res.code == 200){
		   			alert('登录成功！');
		   			window.localStorage.setItem('mm_token',res.data.token);
		   			window.localStorage.setItem('mm_user',res.username);
		   			console.log(window.location)
		   			window.location.href = '/change_password'
                    }else{
                        if(a<1){
                        a+=1;
                        console.log(a);
                        alert(res.error);}
                        else{
                            $('.abc').css("display","");
                            alert(res.error);
                          }
                       }
		   	        }

		        })
    }


</script>
</html>